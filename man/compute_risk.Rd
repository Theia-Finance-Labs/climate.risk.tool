% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_compute_risk.R
\name{compute_risk}
\alias{compute_risk}
\title{Main orchestrator for climate risk assessment pipeline}
\usage{
compute_risk(
  base_dir,
  shock_year,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05,
  verbose = TRUE
)
}
\arguments{
\item{base_dir}{Character string. Base directory containing input data subdirectories:
\itemize{
\item user_input/: asset_information.csv, company.csv
\item areas/: municipality/, province/ with .geojson files
\item hazards/: .tif raster files
\item damage_and_cost_factors.csv
}}

\item{shock_year}{Numeric. Year when acute climate shock occurs (for step 6)}

\item{growth_rate}{Numeric. Revenue growth rate assumption (default: 0.02)}

\item{net_profit_margin}{Numeric. Net profit margin assumption (default: 0.1)}

\item{discount_rate}{Numeric. Discount rate for NPV calculation (default: 0.05)}

\item{verbose}{Logical. Whether to print detailed progress messages (default: TRUE)}
}
\value{
List containing final results:
\itemize{
\item assets: Pivoted asset results with NPV by scenario
\item companies: Pivoted company results with NPV, PD, and Expected Loss by scenario
\item intermediate: List of intermediate results from each pipeline step
}
}
\description{
Executes the complete 16-step climate risk analysis pipeline from raw inputs
to final risk metrics. This function serves as the main entry point and documentation
center for the entire climate risk assessment workflow.
}
\details{
Compute Climate Risk Analysis

The function executes the following 16-step pipeline:
\enumerate{
\item Read inputs: Load asset and company data from CSV files
\item Load hazards: Read climate hazard raster files (.tif)
\item Load areas: Load municipality and province boundary files
\item Geolocate assets: Add geometry and centroid columns using lat/lon > municipality > province priority
\item Cutout hazards: Extract hazard values for each asset geometry
\item Summarize hazards: Calculate mean hazard intensity per asset
\item Join damage factors: Map hazard intensity to damage/cost factors
\item Apply acute shock: Calculate sudden climate event impacts
\item Apply chronic shock: Calculate gradual climate change impacts
\item Compute asset impact: Update share_of_economic_activity with all impacts
\item Build scenarios: Create baseline vs shock scenario data
\item Compute asset revenue: Allocate company revenue to assets
\item Compute asset profits: Apply net profit margins
\item Discount net profits: Apply present value discounting
\item Compute company NPV: Aggregate asset profits to company level
\item Compute company PD: Calculate probability of default using Merton model
\item Compute expected loss: Calculate expected loss using EL = LGD * Loan_Size * PD
\item Gather and pivot results: Transform to wide format for reporting
}
}
\examples{
\dontrun{
# Run complete climate risk analysis
base_dir <- system.file("tests_data", package = "climate.risk.tool")
results <- compute_risk(
  base_dir = base_dir,
  shock_year = 2030,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)

# Access final results
asset_results <- results$assets
company_results <- results$companies

# Access intermediate results for debugging
intermediate_data <- results$intermediate
}
}
