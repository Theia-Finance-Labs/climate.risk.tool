% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_risk.R
\name{compute_risk}
\alias{compute_risk}
\title{Main orchestrator for climate risk assessment pipeline}
\usage{
compute_risk(
  assets,
  companies,
  events,
  hazards,
  hazards_inventory,
  precomputed_hazards,
  damage_factors,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)
}
\arguments{
\item{assets}{Data frame containing asset information (from read_assets())}

\item{companies}{Data frame containing company information (from read_companies())}

\item{events}{data.frame with columns \code{hazard_type}, \code{hazard_name}, \code{scenario_name}, \code{hazard_return_period}, \code{event_year} (or NA), \code{chronic}.
The \code{event_id} column is auto-generated internally if not provided.}

\item{hazards}{Named list of SpatRaster objects (from load_hazards())}

\item{hazards_inventory}{Data frame with hazard metadata including hazard_indicator (from load_hazards_and_inventory()$inventory)}

\item{precomputed_hazards}{Data frame with precomputed hazard statistics for municipalities and provinces (from read_precomputed_hazards())}

\item{damage_factors}{Data frame with damage and cost factors (from read_damage_cost_factors())}

\item{growth_rate}{Numeric. Revenue growth rate assumption (default: 0.02)}

\item{net_profit_margin}{Numeric. Net profit margin assumption (default: 0.1)}

\item{discount_rate}{Numeric. Discount rate for NPV calculation (default: 0.05)
#'}
}
\value{
List containing final results:
\itemize{
\item assets: Pivoted asset results with NPV by scenario (aggregated)
\item companies: Pivoted company results with NPV, PD, and Expected Loss by scenario (aggregated)
\item assets_yearly: Detailed yearly asset trajectories with revenue, profit, and discounted values by year and scenario
\item companies_yearly: Detailed yearly company trajectories with aggregated revenue, profit, and discounted values by year and scenario
}
}
\description{
Orchestrates the climate risk assessment pipeline: (1) compute hazard event impacts on assets
and (2) compute financial results from asset scenarios. This is the single entry point for analysis.
}
\details{
Compute Climate Risk Analysis (orchestrator)

The function executes the following 16-step pipeline:
\enumerate{
\item Read inputs: Load asset and company data from CSV files
\item Load hazards: Read climate hazard raster files (.tif)
\item Load areas: Load municipality and province boundary files
\item Geolocate assets: Add geometry and centroid columns using lat/lon > municipality > province priority
\item Extract hazard statistics: Extract and aggregate hazard values for each asset geometry in long format
\item Join damage factors: Map hazard intensity to damage/cost factors
\item Apply acute shock: Calculate sudden climate event impacts
\item Apply chronic shock: Calculate gradual climate change impacts
\item Compute asset impact: Update share_of_economic_activity with all impacts
\item Build scenarios: Create baseline vs shock scenario data
\item Compute asset revenue: Allocate company revenue to assets
\item Compute asset profits: Apply net profit margins
\item Discount net profits: Apply present value discounting
\item Compute company NPV: Aggregate asset profits to company level
\item Compute company PD: Calculate probability of default using Merton model
\item Compute expected loss: Calculate expected loss using EL = LGD * Loan_Size * PD
\item Gather and pivot results: Transform to wide format for reporting
}
}
\examples{
\dontrun{
# Load required data
base_dir <- system.file("tests_data", package = "climate.risk.tool")
assets <- read_assets(base_dir)
companies <- read_companies(file.path(base_dir, "user_input", "company.csv"))
hazards <- load_hazards(file.path(base_dir, "hazards"))
precomputed_hazards <- read_precomputed_hazards(base_dir)
damage_factors <- read_damage_cost_factors(base_dir)

# Define events
events <- data.frame(
  hazard_type = "flood",
  scenario = "rcp85",
  event_year = 2030,
  chronic = FALSE
)

# Run analysis
results <- compute_risk(
  assets = assets,
  companies = companies,
  events = events,
  hazards = hazards,
  precomputed_hazards = precomputed_hazards,
  damage_factors = damage_factors,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)

# Access final results
asset_results <- results$assets # Aggregated asset NPV by scenario
company_results <- results$companies # Aggregated company NPV, PD, EL by scenario
asset_yearly <- results$assets_yearly # Detailed yearly asset trajectories
company_yearly <- results$companies_yearly # Detailed yearly company trajectories
}
}
