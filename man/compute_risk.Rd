% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_compute_risk.R
\name{compute_risk}
\alias{compute_risk}
\title{Main orchestrator for climate risk assessment pipeline}
\usage{
compute_risk(
  assets,
  companies,
  hazards,
  areas,
  damage_factors,
  shock_year,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05,
  verbose = TRUE
)
}
\arguments{
\item{assets}{Data frame containing asset information (from read_assets())}

\item{companies}{Data frame containing company information (from read_companies())}

\item{hazards}{Named list of SpatRaster objects (from load_hazards())}

\item{areas}{List containing municipalities and provinces named lists (from load_location_areas())}

\item{damage_factors}{Data frame with damage and cost factors, or path to CSV file}

\item{shock_year}{Numeric. Year when acute climate shock occurs (for step 6)}

\item{growth_rate}{Numeric. Revenue growth rate assumption (default: 0.02)}

\item{net_profit_margin}{Numeric. Net profit margin assumption (default: 0.1)}

\item{discount_rate}{Numeric. Discount rate for NPV calculation (default: 0.05)}

\item{verbose}{Logical. Whether to print detailed progress messages (default: TRUE)}
}
\value{
List containing final results:
\itemize{
\item assets: Pivoted asset results with NPV by scenario
\item companies: Pivoted company results with NPV, PD, and Expected Loss by scenario
\item intermediate: List of intermediate results from each pipeline step
}
}
\description{
Executes the complete 16-step climate risk analysis pipeline from pre-loaded inputs
to final risk metrics. This function serves as the main entry point and documentation
center for the entire climate risk assessment workflow.
}
\details{
Compute Climate Risk Analysis

The function executes the following 16-step pipeline:
\enumerate{
\item Read inputs: Load asset and company data from CSV files
\item Load hazards: Read climate hazard raster files (.tif)
\item Load areas: Load municipality and province boundary files
\item Geolocate assets: Add geometry and centroid columns using lat/lon > municipality > province priority
\item Cutout hazards: Extract hazard values for each asset geometry
\item Summarize hazards: Calculate mean hazard intensity per asset
\item Join damage factors: Map hazard intensity to damage/cost factors
\item Apply acute shock: Calculate sudden climate event impacts
\item Apply chronic shock: Calculate gradual climate change impacts
\item Compute asset impact: Update share_of_economic_activity with all impacts
\item Build scenarios: Create baseline vs shock scenario data
\item Compute asset revenue: Allocate company revenue to assets
\item Compute asset profits: Apply net profit margins
\item Discount net profits: Apply present value discounting
\item Compute company NPV: Aggregate asset profits to company level
\item Compute company PD: Calculate probability of default using Merton model
\item Compute expected loss: Calculate expected loss using EL = LGD * Loan_Size * PD
\item Gather and pivot results: Transform to wide format for reporting
}
}
\examples{
\dontrun{
# Load data first
base_dir <- system.file("tests_data", package = "climate.risk.tool")
assets <- read_assets(base_dir)
companies <- read_companies(file.path(base_dir, "user_input", "company.csv"))
hazards <- load_hazards(file.path(base_dir, "hazards"))
areas <- load_location_areas(
  file.path(base_dir, "areas", "municipality"),
  file.path(base_dir, "areas", "province")
)
damage_factors_path <- file.path(base_dir, "damage_and_cost_factors.csv")

# Run complete climate risk analysis
results <- compute_risk(
  assets = assets,
  companies = companies,
  hazards = hazards,
  areas = areas,
  damage_factors = damage_factors_path,
  shock_year = 2030,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)

# Access final results
asset_results <- results$assets
company_results <- results$companies

# Access intermediate results for debugging
intermediate_data <- results$intermediate
}
}
