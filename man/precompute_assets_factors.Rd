% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils__precompute_assets_factors.R
\name{precompute_assets_factors}
\alias{precompute_assets_factors}
\title{Precompute and cache assets factors for climate risk analysis}
\usage{
precompute_assets_factors(
  assets,
  hazards,
  areas,
  damage_factors,
  hazards_dir,
  progress_callback = NULL,
  force_recompute = FALSE
)
}
\arguments{
\item{assets}{Data frame containing asset information (from read_assets())}

\item{hazards}{Named list of SpatRaster objects (from load_hazards())}

\item{areas}{List containing municipalities and provinces named lists (from load_location_areas())}

\item{damage_factors}{Data frame with damage and cost factors, or path to CSV file}

\item{hazards_dir}{Character string specifying the hazards directory where precomputed results will be saved}

\item{progress_callback}{Optional function to call with progress updates (processed, total, message)}

\item{force_recompute}{Logical. If TRUE, recompute even if cached file exists (default: FALSE)}
}
\value{
Character string path to the saved precomputed assets factors file
}
\description{
Precomputes the expensive geospatial operations (geolocation, hazard cutout,
summarization, and damage factor joining) and saves the results to disk. This allows
the main compute_risk function to run much faster by loading precomputed data instead
of performing these operations every time.
}
\details{
Precompute assets factors for efficient risk analysis

The function performs the following operations:
\enumerate{
\item Checks if precomputed file exists and is complete
\item If not complete or force_recompute=TRUE, performs geospatial operations:
\itemize{
\item Geolocates assets using lat/lon > municipality > province priority
\item Cuts out hazard values for each asset geometry
\item Summarizes hazards in long format (one row per asset-hazard combination)
\item Joins damage and cost factors
}
\item Saves results to hazards_dir/assets_factors_precomputed.rds
\item Returns path to saved file
}

The precomputed file contains a data frame with all assets enriched with:
\itemize{
\item Geometry and centroid information
\item Hazard intensity values for each hazard scenario
\item Damage and cost factors for each asset-hazard combination
}
}
\examples{
\dontrun{
# Load required data
base_dir <- system.file("tests_data", package = "climate.risk.tool")
assets <- read_assets(base_dir)
hazards <- load_hazards(file.path(base_dir, "hazards"))
areas <- load_location_areas(
  file.path(base_dir, "areas", "municipality"),
  file.path(base_dir, "areas", "province")
)
damage_factors <- read_damage_cost_factors(base_dir)

# Precompute assets factors
precomputed_file <- precompute_assets_factors(
  assets = assets,
  hazards = hazards,
  areas = areas,
  damage_factors = damage_factors,
  hazards_dir = file.path(base_dir, "hazards")
)

# Use in compute_risk
results <- compute_risk(
  assets = assets,
  companies = companies,
  precomputed_assets_factors = precomputed_file,
  events = events
)
}
}
