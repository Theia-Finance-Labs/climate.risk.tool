---
title: "getting-started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE # Don't evaluate code chunks - this is a usage guide
)
```

```{r setup}
library(climate.risk.tool)

# Set the path to your data directory
# This should contain:
# - user_input/asset_information.csv
# - user_input/company.csv
# - hazards/[hazard_type]/*.tif files
# - areas/municipality/*.geojson
# - areas/province/*.geojson
# - damage_and_cost_factors.csv
base_dir <- system.file("tests", "tests_data", package = "climate.risk.tool")
```

## Prepare inputs

Load all required data from your base directory:

```{r}
# Load all required data
assets <- read_assets(base_dir)
companies <- read_companies(file.path(base_dir, "user_input", "company_small.csv"))
hazards <- load_hazards(file.path(base_dir, "hazards"), aggregate_factor=1L)
areas <- load_location_areas(
  file.path(base_dir, "areas", "municipality"),
  file.path(base_dir, "areas", "province")
)
damage_factors <- read_damage_cost_factors(base_dir)
```

## Define events

Define the climate scenarios you want to analyze:

```{r}
# Create test events
events <- data.frame(
  event_id = c("event_1", "event_2"),
  hazard_type = c("flood", "flood"),
  hazard_name = c(
    "flood__global_rcp85_h100glob_brazil",
    "flood__global_rcp85_h10glob_brazil"
    ),
  event_year = c(2030, 2030),
  chronic = c(FALSE, FALSE),
  stringsAsFactors = FALSE
)
```

## Run the model

Run the complete climate risk analysis pipeline:

```{r}
# Run the complete climate risk analysis
results <- compute_risk(
  assets = assets,
  companies = companies,
  events = events,
  hazards = hazards,
  areas = areas,
  damage_factors = damage_factors,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)
```



## Explore results

The results object contains multiple dataframes with different levels of detail:

### Assets hazard exposure and damage factors

Shows how each asset is exposed to different hazards:

```{r}
results$assets_factors
```

### Assets yearly profits trajectory

Detailed year-by-year profit projections for each asset under different scenarios:

```{r}
results$assets_yearly
```

### Companies yearly profits trajectory

Aggregated year-by-year profit projections at the company level:

```{r}
results$companies_yearly
```

### Assets aggregated financials

Summary NPV metrics for each asset by scenario:

```{r}
results$assets
```

### Companies aggregated financials

Final company-level risk metrics including NPV, Probability of Default (PD), and Expected Loss:

```{r}
results$companies
```



