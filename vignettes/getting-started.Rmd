---
title: "getting-started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(climate.risk.tool)
base_dir <- "tests/tests_data"
```

## Prepare inputs

```{r}

# Load all required data
assets <- read_assets(base_dir)
companies <- read_companies(file.path(base_dir, "user_input", "company.csv"))
hazards <- load_hazards(file.path(base_dir, "hazards"))
areas <- load_location_areas(
  file.path(base_dir, "areas", "municipality"),
  file.path(base_dir, "areas", "province")
)
damage_factors <- read_damage_cost_factors(base_dir)
```

## Define events

```{r}

# Create test events
events <- data.frame(
  event_id = "event_1",
  hazard_type = "flood",
  scenario = "amazonas_global_rcp85_h100glob",
  event_year = 2030,
  chronic = FALSE,
  stringsAsFactors = FALSE
)

```


## Precompute assets factors (recommended for faster analysis)

```{r}

# Precompute assets factors once (this is the slow step)
precomputed_file <- precompute_assets_factors(
  assets = assets,
  hazards = hazards,
  areas = areas,
  damage_factors = damage_factors,
  hazards_dir = file.path(base_dir, "hazards")
)

```

## Run the model

```{r}

# Run analysis with precomputed data (fast!)
results <- compute_risk(
  assets = assets,
  companies = companies,
  events = events,
  precomputed_assets_factors = precomputed_file,
  growth_rate = 0.02,
  net_profit_margin = 0.1,
  discount_rate = 0.05
)

```



## Explore results

Assets exposure : 
```{r}
results$assets_factors
```

Assets yearly profits

```{r}
results$assets_yearly
```

Companies yearly profits

```{r}
results$companies_yearly
```

Assets financials

```{r}
results$assets
```

Companies financials

```{r}
results$companies
```



